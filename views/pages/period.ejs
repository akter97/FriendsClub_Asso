 <style>
    :root {
        --primary: #4e73df;
        --success: #1cc88a;
        --warning: #f6c23e;
        --danger: #e74a3b; 
    }
    body{
        padding: 20%;
    }

    .admin-container { background: var(--light-bg); min-height: 100vh; font-family: 'Nunito', sans-serif; }
    
    .setup-card, .list-card {
        margin: 0px 20px;
        background: #f4f4f8a5;
        border-radius: 12px;
        box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.1);
        margin-bottom: 30px;
        padding: 15px;
        max-width: 900px; 
    }

    .card-header, .list-header { display: flex; align-items: center; gap: 15px; margin-bottom: 25px; border-bottom: 1px solid #e3e6f0; padding-bottom: 15px; }
    .header-icon { font-size: 30px; color: var(--primary); }
    .header-text h2, .list-header h3 { margin: 0; font-size: 20px; color: #333; }
    .header-text p { margin: 0; font-size: 13px; color: #858796; }

    .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 25px; }
    .input-box label { display: block; font-size: 13px; font-weight: 700; color: #4e73df; margin-bottom: 8px; }
    .field-wrapper { position: relative; }
    .field-wrapper i { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: #b7b9cc; }
    
    input[type="month"], select {
        width: 100%;
        padding: 12px 12px 12px 40px;
        border: 1px solid #d1d3e2;
        border-radius: 8px;
        outline: none;
        box-sizing: border-box;
    }

    .btn-primary {
        width: 100%;
        background: var(--primary);
        color: #fff;
        border: none;
        padding: 14px;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        display: flex;
        justify-content: center;
        gap: 10px;
        transition: 0.3s;
    }

    .btn-primary:hover { background: #2e59d9; }

    table { width: 100%; border-collapse: collapse; }
    th { background: #f8f9fc; padding: 12px; text-align: left; font-size: 13px; color: #4e73df; border-bottom: 2px solid #e3e6f0; }
    td { padding: 12px; border-bottom: 1px solid #e3e6f0; font-size: 14px; color: #5a5c69; }
    
    .badge { padding: 5px 10px; border-radius: 20px; font-size: 11px; text-transform: uppercase; font-weight: 700; }
    .badge-active { background: #d1f7e8; color: var(--success); }
    .badge-upcoming { background: #fff3cd; color: var(--warning); }
    .badge-inactive { background: #f8d7da; color: var(--danger); }

    .btn-sm { padding: 6px 10px; border: none; border-radius: 4px; cursor: pointer; }
    .edit { background: var(--primary); color: #fff; }
    .delete { background: var(--danger); color: #fff; }
 
    .input-box-full {
        grid-column: span 2;  
    }

    .input-box-full label {
        display: block; 
        font-size: 13px; 
        font-weight: 700; 
        color: #4e73df; 
        margin-bottom: 8px;
    }
 input[type="number"] {
        width: 100%;
        padding: 12px 12px 12px 40px;
        border: 1px solid #d1d3e2;
        border-radius: 8px;
        outline: none;
        box-sizing: border-box;
    }
    @media (max-width: 600px) { .form-grid { grid-template-columns: 1fr; } }



  
.search-section {
    margin-bottom: 25px;
    display: flex;
    justify-content: flex-start;  
}

.search-container {
    width: 100%;
    max-width: 400px; 
}

.search-glow {
    position: relative;
    background: #ffffff;
    border: 1px solid #e3e6f0;
    border-radius: 50px;  
    padding: 2px;
    transition: all 0.3s ease;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
}

.search-glow:focus-within {
    border-color: #4e73df;
    box-shadow: 0 8px 15px rgba(78, 115, 223, 0.15);
    transform: translateY(-2px); 
}

.search-icon {
    position: absolute;
    left: 18px;
    top: 50%;
    transform: translateY(-50%);
    color: #4e73df;
    font-size: 16px;
    transition: all 0.3s ease;
}

.search-glow input[type="text"] {
    width: 100%;
    border: none !important;  
    background: transparent;
    padding: 12px 15px 12px 48px;
    border-radius: 50px;
    outline: none;
    font-size: 14px;
    color: #5a5c69;
}
 
.search-glow:focus-within .search-icon {
    scale: 1.2;
    color: #2e59d9;
}
 
.search-line {
    position: absolute;
    bottom: 8px;
    left: 50px;
    right: 20px;
    height: 2px;
    background: linear-gradient(90deg, #4e73df, transparent);
    transform: scaleX(0);
    transition: transform 0.4s ease;
    transform-origin: left;
}

.search-glow input:focus + .search-line {
    transform: scaleX(1);
} 
</style>

 <div class="admin-container">
    <div class="setup-card">
        <div class="card-header">
            <div class="header-icon"><i class="fas fa-calendar-alt"></i></div>
            <div class="header-text">
                <h2>Period Configuration</h2>
                <p>Set up and manage transaction periods</p>
            </div>
        </div>

        <form action="/period/add" method="POST" class="dynamic-form" id="periodForm">
            <input type="hidden" name="id" id="periodId">

            <div class="form-grid">
                <div class="input-box">
                    <label>Select Month & Year</label>
                    <div class="field-wrapper">
                        <i class="far fa-calendar-check"></i>
                        <input type="month" name="selectedMonth" id="selectedMonth" required>
                    </div>
                </div>

                <div class="input-box">
                    <label>Period Status</label>
                    <div class="field-wrapper">
                        <i class="fas fa-info-circle"></i>
                        <select name="status" id="status" required>
                            <option value="upcoming">Upcoming</option>
                            <option value="active">Active</option>
                            <option value="inactive">Inactive</option>
                        </select>
                    </div>
                </div>
                 <div class="input-box-full">
                    <label>Monthly Installment Amount</label>
                    <div class="field-wrapper">
                        <i class="fas fa-money-bill-wave"></i>
                        <input type="number" name="amount" id="amount" placeholder="Enter Amount (e.g. 5000)" required>
                    </div>
                </div>
            </div>

            <button type="submit" class="btn-primary" id="submitBtn">
                <span>Save Period</span>
                <i class="fas fa-save"></i>
            </button>
        </form>
    </div>

    <div class="list-card">
        <div class="list-header">
            <h3><i class="fas fa-list"></i> Existing Periods</h3>
        </div>
        <div class="search-box-container" style="margin-bottom: 15px;">
         <div class="search-section">
    <div class="search-container">
        <div class="field-wrapper search-glow">
            <i class="fas fa-search search-icon"></i>
            <input type="text" id="periodSearch" 
                   placeholder="Search by Month, Year or Status..." 
                   onkeyup="filterPeriods()"
                   autocomplete="off">
            <div class="search-line"></div>
        </div>
    </div>
</div>
    </div>
        <div class="table-responsive">
            <table id="periodTable">
                <thead>
                    <tr>
                        <th>Process</th>
                        <th>Month</th>
                        <th>Year</th>
                        <th>Amount</th>
                        <th>Status</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    <% if (periods && periods.length > 0) { %>
                        <% periods.forEach(p => { %>
                        <tr> 
                            <td style="text-align: center;">
                                <% if (p.process == 1) { %>
                                    <div class="process-status completed">
                                        <i class="fas fa-check-circle"></i>                                       
                                    </div>
                                <% } else { %>
                                    <label class="custom-checkbox">
                                        <input type="checkbox" onchange="handleProcess(this,'<%= p.id %>', '<%= p.month_name %>','<%= p.amount %>')">
                                        <span class="checkmark"></span>
                                    </label>
                                <% } %>
                            </td>
                            <td><strong><%= p.month_name %></strong></td>
                            <td><%= p.year %></td>
                            <td><%= p.amount %></td>
                            <td>
                                <span class="badge badge-<%= p.status %>"><%= p.status %></span>
                            </td>
                            <td>
                                 <% if (p.process != 1) { %>
                                <button class="btn-sm edit" 
                                    onclick="editPeriod('<%= p.id %>', '<%= p.year %>-<%= p.month_number.toString().padStart(2, '0') %>', '<%= p.status %>', '<%= p.amount || 0 %>')">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn-sm delete"><i class="fas fa-trash"></i></button>
                                 <% } %>
                                   <% if (p.process == 1) { %>
                               
                                <b style="padding: 5px; background: rgba(21, 142, 21, 0.929); border-radius: 3%;color:wheat">Processed</b>
                                 <% } %>

                                 
                            </td>
                        </tr>
                        <% }) %>
                    <% } else { %>
                        <tr>
                            <td colspan="5" style="text-align: center; padding: 20px; color: #888;">No periods found.</td>
                        </tr>
                    <% } %>
                </tbody>
            </table>
        </div>
    </div>
</div> 

<script>
 
 function handleProcess(checkbox, id, month, amount) { 
    const currentState = checkbox.checked; 
   const userChoice = confirm(`Are you sure you want to process the amount of ${amount} for ${month}?`);
    if (userChoice) {     
         
         fetch('period/processPayment', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            periodId: id,
            month: month,
            amount: amount,
            status: '1'
        })
    })
    .then(res => res.json())
    .then(data => {
        if (data.success) {
            alert('Payment processed successfully!');
        } else {
            alert('Processing failed!');
            checkbox.checked = !currentState;
        }
    })
    .catch(err => {
        console.error(err);
        alert('Server error!');
        checkbox.checked = !currentState;
    });
        console.log("Processing API for ID:", id);
        
    }
     else {  
        checkbox.checked = !currentState;
    }
}
 
 
 
 
 function filterPeriods() {    
    const input = document.getElementById('periodSearch');
    const filter = input.value.toLowerCase();
    const table = document.getElementById('periodTable'); 
    const tr = table.getElementsByTagName('tr'); 
    for (let i = 1; i < tr.length; i++) {
        let matchFound = false;
        const tds = tr[i].getElementsByTagName('td');
         
        for (let j = 0; j < tds.length - 1; j++) { 
            if (tds[j]) {
                const textValue = tds[j].textContent || tds[j].innerText;
                if (textValue.toLowerCase().indexOf(filter) > -1) {
                    matchFound = true;
                    break;
                }
            }
        }

        if (matchFound) {
            tr[i].style.display = "";
        } else { 
            if (tr[i].innerText.indexOf("No periods found") === -1) {
                tr[i].style.display = "none";
            }
        }
    }
}


function editPeriod(id, monthValue, status) { 
    document.getElementById('periodId').value = id;
    document.getElementById('selectedMonth').value = monthValue;
    document.getElementById('status').value = status; 
    document.getElementById('periodForm').action = '/period/update'; 
    document.querySelector('#submitBtn span').innerText = "Update Period";
    document.querySelector('#submitBtn i').className = "fas fa-sync-alt"; 
    window.scrollTo({ top: 0, behavior: 'smooth' });
}
</script>