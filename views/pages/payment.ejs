 <style>
    
  :root {
    --glass-bg: rgba(255, 255, 255, 0.08);
    --glass-border: rgba(255, 255, 255, 0.15);
    --primary-color: #00d2ff;
    --text-main: #ffffff;
    --text-dim: #b3b3b3;
    --input-bg: rgba(0, 0, 0, 0.3);
  }

  .payment-container {
    position: relative;
    overflow: hidden;
    max-width: 480px;
    margin: 10px auto;
    padding: 10px;
    background: var(--glass-bg);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border-radius: 24px;
    border: 1px solid var(--glass-border);
    color: var(--text-main);
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
    font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
  }
.view-icon {
  position: absolute;
  top: 0;
  right: 0;
  background: rgba(255, 255, 255, 0.15);
  padding: 10px 18px;
  color: white;
  text-decoration: none;
  font-size: 13px;
  font-weight: 500;
  /* Top-right corner matching radius */
  border-bottom-left-radius: 20px; 
  transition: all 0.3s ease;
  backdrop-filter: blur(5px);
  border-left: 1px solid var(--glass-border);
  border-bottom: 1px solid var(--glass-border);
}

.view-icon:hover {
  background: var(--primary-color);
  color: #000;
  box-shadow: 0 0 15px var(--primary-color);
}

.view-icon i {
  margin-right: 5px;
}
  .payment-container h2 { 
    text-align: center; 
    margin-bottom: 30px; 
    font-weight: 600; 
    letter-spacing: 1px;
    font-size: 24px;
  }

  .input-box { margin-bottom: 20px; }

  .input-box label { 
    display: block; 
    margin-bottom: 8px; 
    font-size: 13px; 
    font-weight: 500;
    color: var(--text-dim); 
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  /* Input, Select, Textarea common styling */
  .input-box select, 
  .input-box input, 
  .input-box textarea {
    width: 100%;
    padding: 4px 6px; /* Increased padding for better touch area */
    background: var(--input-bg);
    border: 1px solid var(--glass-border);
    border-radius: 12px;
    color: #fff;
    font-size: 15px;
    outline: none;
    box-sizing: border-box; /* Ensures padding doesn't affect width */
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  /* Specific color for dropdown options to ensure readability */
  .input-box select option {
    background-color: #294592c8;
    color: #fff;
  }

  /* Hover & Focus states */
  .input-box input:hover, .input-box select:hover {
    border-color: rgba(255, 255, 255, 0.4);
  }

  .input-box input:focus, .input-box select:focus { 
    border-color: var(--primary-color);
    background: rgba(0, 0, 0, 0.4);
    box-shadow: 0 0 0 3px rgba(0, 210, 255, 0.2);
  }

  /* File input specific styling */
  .input-box input[type="file"] {
    padding: 10px;
    font-size: 13px;
    cursor: pointer;
  }

  #transID_box { display: none; }

  .submit-btn {
    display: block;
    width: 80%;
    padding: 16px;
    margin: 15px auto !important;
    background: linear-gradient(135deg, #00d2ff 0%, #3a7bd5 100%);
    border: none;
    border-radius: 12px;
    color: white;
    font-size: 16px;
    font-weight: 700;
    cursor: pointer; 
    box-shadow: 0 4px 15px rgba(0, 210, 255, 0.3);
    transition: all 0.3s ease;
  }

  .submit-btn:hover { 
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(0, 210, 255, 0.4);
    filter: brightness(1.1);
  }

  .submit-btn:active { transform: translateY(0); }

  



  /* Modal Background */
.modal {
  display: none;
  position: fixed;
  z-index: 1000;
  left: 0; top: 0; width: 100%; height: 100%;
  background-color: rgba(34, 39, 100, 0.777);
  backdrop-filter: blur(8px);
}

.modal-content {
  max-width: 650px !important;
  margin: 50px auto;
  position: relative;
  animation: slideDown 0.4s ease;
}

@keyframes slideDown {
  from { transform: translateY(-50px); opacity: 0; }
  to { transform: translateY(0); opacity: 1; }
}

.close-modal {
  position: absolute;
  top: 15px; right: 20px;
  font-size: 28px; color: #ccc; cursor: pointer;
}

/* History Table Style */
.history-table {
  width: 100%; border-collapse: collapse; margin-top: 15px;
}

.history-table th, .history-table td {
  padding: 12px; text-align: left;
  border-bottom: 1px solid var(--glass-border);
  font-size: 13px;
}

.history-table th { color: var(--primary-color); }

.action-btns i {
  margin: 0 5px; cursor: pointer; transition: 0.3s;
}

.fa-edit { color: #ffc107; }
.fa-trash { color: #ff5252; }

/* Status Badge */
.status-badge {
  padding: 3px 8px; border-radius: 5px; font-size: 11px;
}
.status-Paid { background: #2ecc71; color: white; }
.status-Pending { background: #abf207; color: rgb(8, 0, 0); }
</style>

<div class="payment-container">
    <a href="/payment-history" class="view-icon" title="View History">
    <i class="fas fa-eye"></i> <span>View</span> </a>
  <h2>Make Payment</h2> 
  <form action="/payment" method="POST" enctype="multipart/form-data" id="paymentForm">
    
    <div class="input-box">
      <label>Date</label>
      <input type="date" name="payment_date" id="currentDate" required>
    </div>

  <div class="input-box">
  <label>Select Member Code</label>
  <select name="member_id" id="memberSelect" required>
    <option value="" disabled selected>-- Select Code --</option>
    <% memberCodes.forEach(item => { %>
      <option value="<%= item.member_id %>" data-code="<%= item.MemberCode %>">
        <%= item.MemberCode %>
      </option>
    <% }) %>
  </select>
</div>

<input type="hidden" name="share_number" id="hidden_share_number">

    <div class="input-box">
      <label>Payment Method</label>
      <select name="payment_method" id="payMethod" required>
        <option value="Cash">Cash</option>
        <option value="bKash">bKash</option>
        <option value="Nagad">Nagad</option>
        <option value="Bank">Bank</option>
      </select>
    </div>

    <div class="input-box" id="transID_box">
      <label>Transaction ID</label>
      <input type="text" name="transaction_id" id="transaction_id" placeholder="Enter TxnID">
    </div>

    <div class="input-box">
      <label>Amount</label>
      <input type="number" name="amount" step="0.01" placeholder="Enter Amount" required>
    </div>

    <div class="input-box">
      <label>Reference</label>
      <select name="reference">
        <option value="None">None</option>
        <% references.forEach(refUser => { %>
          <option value="<%= refUser.id %>"><%= refUser.name %></option>
        <% }) %>
      </select>
    </div>

    <input type="hidden" name="payment_status" value="Due">

    <div class="input-box">
      <label>Receipt (Optional)</label>
      <input type="file" name="receipt_image" accept="image/*">
    </div>

    <div class="input-box">
      <label>Remarks</label>
      <textarea name="remarks" rows="2"></textarea>
    </div>

    <button type="submit" class="submit-btn">Submit Payment</button>
  </form>
</div>



<div id="historyModal" class="modal">
  <div class="modal-content payment-container">
    <span class="close-modal">&times;</span>
    <h3>Payment History</h3>
    <div class="table-responsive">
      <table class="history-table">
        <thead>
          <tr>
            <th>Code</th>
            <th>Date</th>
            <th>Amount</th>
            <th>Status</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody id="historyBody">
          </tbody>
      </table>
    </div>
  </div>
</div>
<script> 
// Dropdown change hole hidden field-e code-ti set hobe
  document.getElementById('memberSelect').addEventListener('change', function() {
    const selectedOption = this.options[this.selectedIndex];
    const code = selectedOption.getAttribute('data-code');
    document.getElementById('hidden_share_number').value = code;
  });
  document.getElementById('currentDate').valueAsDate = new Date(); 
  const payMethod = document.getElementById('payMethod');
  const transBox = document.getElementById('transID_box');
  const transInput = document.getElementById('transaction_id');

  payMethod.addEventListener('change', function() {
    if (this.value === 'Cash') {
      transBox.style.display = 'none';
      transInput.removeAttribute('required');
      transInput.value = ""; // Clear value
    } else {
      transBox.style.display = 'block';
      transInput.setAttribute('required', 'required');
    }
  });
</script>

<script>
const modal = document.getElementById("historyModal");
const viewBtn = document.querySelector(".view-icon");
const closeBtn = document.querySelector(".close-modal");

// Modal Open korle data fetch hobe
viewBtn.onclick = function(e) {
  e.preventDefault();
  modal.style.display = "block";
  fetchHistory();
}

closeBtn.onclick = function() { modal.style.display = "none"; }

window.onclick = function(event) {
  if (event.target == modal) modal.style.display = "none";
}

 function fetchHistory() {
  fetch('/payment-history-data')
    .then(res => res.json())
    .then(data => {
      let html = '';
      data.forEach(row => {
        // Status check kore action buttons toiri kora
        let actionButtons = '';
        if (row.status === 'Pending') { 
            actionButtons = `
              <i class="fas fa-edit" onclick="editPayment(${row.id})"></i>
              <i class="fas fa-trash" onclick="deletePayment(${row.id})"></i>
            `;
        } else {
            // Paid ba onno status hole icon gulo show korbe na
            actionButtons = `<i class="fas fa-view" onclick="view(${row.id})"></i>`;
        }

        html += `
          <tr>
            <td>${row.shere_number}</td>
            <td>${new Date(row.payment_date).toLocaleDateString()}</td>
            <td>${row.amount}</td>
            <td><span class="status-badge status-${row.status}">${row.status}</span></td>
            <td class="action-btns">
              ${actionButtons}
            </td>
          </tr>`;
      });
      document.getElementById("historyBody").innerHTML = html;
    });
}
// Payment Delete korar function
function deletePayment(id) {
    if (confirm("Are you sure you want to delete this payment record?")) {
        fetch(`/payment/delete/${id}`, {
            method: 'DELETE'
        })
        .then(res => res.json())
        .then(data => {
            if (data.success) {
                alert(data.message);
                fetchHistory(); // Table-ti auto-refresh hobe
            } else {
                alert("Error: " + data.message);
            }
        })
        .catch(err => console.error("Error:", err));
    }
}

function editPayment(id) {
    alert(99);
    // 1. Fetch single data for the specific ID
    fetch(`/payment/get/${id}`)
        .then(res => res.json())
        .then(data => {
            // Modal bondho kora
            modal.style.display = "none";

            // 2. Form field gulo fill kora (Patching)
            document.getElementById('memberSelect').value = data.member_id;
            document.getElementById('hidden_share_number').value = data.shere_number;
            document.getElementById('payMethod').value = data.payment_method;
            document.querySelector('input[name="amount"]').value = data.amount;
            document.querySelector('select[name="reference"]').value = data.reference || 'None';
            document.querySelector('textarea[name="remarks"]').value = data.remarks;
            
            // Date formatting (YYYY-MM-DD)
            const formattedDate = new Date(data.payment_date).toISOString().split('T')[0];
            document.getElementById('currentDate').value = formattedDate;

            // 3. Transaction ID logic handling
            if (data.payment_method !== 'Cash') {
                transBox.style.display = 'block';
                transInput.value = data.transaction_id;
                transInput.setAttribute('required', 'required');
            } else {
                transBox.style.display = 'none';
                transInput.value = "";
                transInput.removeAttribute('required');
            }

            // 4. Update Mode On kora
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.innerText = "Update Payment"; // Button text change
            submitBtn.style.background = "linear-gradient(135deg, #f2994a 0%, #f2c94c 100%)"; // Visual alert (Orange color)

            // 5. Form Action Change (Jate update route-e jay)
            const form = document.getElementById('paymentForm');
            form.action = `/payment/update/${id}`;

            // 6. Scroll up jate user form-ti dekhte pay
            window.scrollTo({ top: 0, behavior: 'smooth' });
        })
        .catch(err => console.error("Error fetching payment data:", err));
}
</script>